{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = undefined && undefined.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.operationDerivedDataCacheKey = exports.createOperationDerivedDataCache = void 0;\nconst lru_cache_1 = __importDefault(require(\"lru-cache\"));\nfunction createOperationDerivedDataCache({\n  logger\n}) {\n  let lastWarn;\n  let lastDisposals = 0;\n  return new lru_cache_1.default({\n    length(obj) {\n      return Buffer.byteLength(JSON.stringify(obj), 'utf8');\n    },\n    max: Math.pow(2, 20) * 10,\n    dispose() {\n      lastDisposals++;\n      if (!lastWarn || new Date().getTime() - lastWarn.getTime() > 60000) {\n        lastWarn = new Date();\n        logger.warn(['This server is processing a high number of unique operations.  ', `A total of ${lastDisposals} records have been `, 'ejected from the ApolloServerPluginUsageReporting signature cache in the past ', 'interval.  If you see this warning frequently, please open an ', 'issue on the Apollo Server repository.'].join(''));\n        lastDisposals = 0;\n      }\n    }\n  });\n}\nexports.createOperationDerivedDataCache = createOperationDerivedDataCache;\nfunction operationDerivedDataCacheKey(queryHash, operationName) {\n  return `${queryHash}${operationName && ':' + operationName}`;\n}\nexports.operationDerivedDataCacheKey = operationDerivedDataCacheKey;","map":{"version":3,"mappings":";;;;;;;;;;;AAAA,MAAAA,WAAA,GAAAC,eAAA,CAAAC,OAAA;AASA,SAAgBC,+BAA+BA,CAAC;EAC9CC;AAAM,CAGP;EACC,IAAIC,QAAc;EAClB,IAAIC,aAAa,GAAW,CAAC;EAC7B,OAAO,IAAIN,WAAA,CAAAO,OAAQ,CAA+B;IAEhDC,MAAMA,CAACC,GAAG;MACR,OAAOC,MAAM,CAACC,UAAU,CAACC,IAAI,CAACC,SAAS,CAACJ,GAAG,CAAC,EAAE,MAAM,CAAC;IACvD,CAAC;IASDK,GAAG,EAAEC,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,GAAG,EAAE;IACzBC,OAAOA,CAAA;MAELX,aAAa,EAAE;MAGf,IAAI,CAACD,QAAQ,IAAI,IAAIa,IAAI,EAAE,CAACC,OAAO,EAAE,GAAGd,QAAQ,CAACc,OAAO,EAAE,GAAG,KAAK,EAAE;QAElEd,QAAQ,GAAG,IAAIa,IAAI,EAAE;QACrBd,MAAM,CAACgB,IAAI,CACT,CACE,iEAAiE,EACjE,cAAcd,aAAa,qBAAqB,EAChD,gFAAgF,EAChF,gEAAgE,EAChE,wCAAwC,CACzC,CAACe,IAAI,CAAC,EAAE,CAAC,CACX;QAGDf,aAAa,GAAG,CAAC;;IAErB;GACD,CAAC;AACJ;AA5CAgB,OAAA,CAAAnB,+BAAA,GAAAA,+BAAA;AA8CA,SAAgBoB,4BAA4BA,CAC1CC,SAAiB,EACjBC,aAAqB;EAErB,OAAO,GAAGD,SAAS,GAAGC,aAAa,IAAI,GAAG,GAAGA,aAAa,EAAE;AAC9D;AALAH,OAAA,CAAAC,4BAAA,GAAAA,4BAAA","names":["lru_cache_1","__importDefault","require","createOperationDerivedDataCache","logger","lastWarn","lastDisposals","default","length","obj","Buffer","byteLength","JSON","stringify","max","Math","pow","dispose","Date","getTime","warn","join","exports","operationDerivedDataCacheKey","queryHash","operationName"],"sourceRoot":"","sources":["../../../src/plugin/usageReporting/operationDerivedDataCache.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}