{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TAG_VERSIONS = exports.TagSpecDefinition = exports.tagIdentity = void 0;\nconst graphql_1 = require(\"graphql\");\nconst coreSpec_1 = require(\"./coreSpec\");\nconst definitions_1 = require(\"./definitions\");\nconst directiveAndTypeSpecification_1 = require(\"./directiveAndTypeSpecification\");\nconst error_1 = require(\"./error\");\nconst knownCoreFeatures_1 = require(\"./knownCoreFeatures\");\nconst types_1 = require(\"./types\");\nexports.tagIdentity = 'https://specs.apollo.dev/tag';\nclass TagSpecDefinition extends coreSpec_1.FeatureDefinition {\n  constructor(version, minimumFederationVersion) {\n    super(new coreSpec_1.FeatureUrl(exports.tagIdentity, 'tag', version), minimumFederationVersion);\n    this.tagLocations = [graphql_1.DirectiveLocation.FIELD_DEFINITION, graphql_1.DirectiveLocation.OBJECT, graphql_1.DirectiveLocation.INTERFACE, graphql_1.DirectiveLocation.UNION];\n    this.printedTagDefinition = 'directive @tag(name: String!) repeatable on FIELD_DEFINITION | INTERFACE | OBJECT | UNION';\n    if (!this.isV01()) {\n      this.tagLocations.push(graphql_1.DirectiveLocation.ARGUMENT_DEFINITION, graphql_1.DirectiveLocation.SCALAR, graphql_1.DirectiveLocation.ENUM, graphql_1.DirectiveLocation.ENUM_VALUE, graphql_1.DirectiveLocation.INPUT_OBJECT, graphql_1.DirectiveLocation.INPUT_FIELD_DEFINITION);\n      this.printedTagDefinition = 'directive @tag(name: String!) repeatable on FIELD_DEFINITION | INTERFACE | OBJECT | UNION | ARGUMENT_DEFINITION | SCALAR | ENUM | ENUM_VALUE | INPUT_OBJECT | INPUT_FIELD_DEFINITION';\n      if (!this.isV02()) {\n        this.tagLocations.push(graphql_1.DirectiveLocation.SCHEMA);\n        this.printedTagDefinition = 'directive @tag(name: String!) repeatable on FIELD_DEFINITION | INTERFACE | OBJECT | UNION | ARGUMENT_DEFINITION | SCALAR | ENUM | ENUM_VALUE | INPUT_OBJECT | INPUT_FIELD_DEFINITION | SCHEMA';\n      }\n    }\n    this.tagDirectiveSpec = (0, directiveAndTypeSpecification_1.createDirectiveSpecification)({\n      name: 'tag',\n      locations: this.tagLocations,\n      repeatable: true,\n      args: [{\n        name: 'name',\n        type: schema => new definitions_1.NonNullType(schema.stringType())\n      }],\n      composes: true,\n      supergraphSpecification: fedVersion => exports.TAG_VERSIONS.getMinimumRequiredVersion(fedVersion)\n    });\n    this.registerDirective(this.tagDirectiveSpec);\n  }\n  isV01() {\n    return this.version.equals(new coreSpec_1.FeatureVersion(0, 1));\n  }\n  isV02() {\n    return this.version.equals(new coreSpec_1.FeatureVersion(0, 2));\n  }\n  tagDirective(schema) {\n    return this.directive(schema, 'tag');\n  }\n  checkCompatibleDirective(definition) {\n    const hasUnknownArguments = Object.keys(definition.arguments()).length > 1;\n    const nameArg = definition.argument('name');\n    const hasValidNameArg = nameArg && (0, types_1.sameType)(nameArg.type, new definitions_1.NonNullType(definition.schema().stringType()));\n    const hasValidLocations = definition.locations.every(loc => this.tagLocations.includes(loc));\n    if (hasUnknownArguments || !hasValidNameArg || !hasValidLocations) {\n      return error_1.ERRORS.DIRECTIVE_DEFINITION_INVALID.err(`Found invalid @tag directive definition. Please ensure the directive definition in your schema's definitions matches the following:\\n\\t${this.printedTagDefinition}`);\n    }\n    return undefined;\n  }\n}\nexports.TagSpecDefinition = TagSpecDefinition;\nexports.TAG_VERSIONS = new coreSpec_1.FeatureDefinitions(exports.tagIdentity).add(new TagSpecDefinition(new coreSpec_1.FeatureVersion(0, 1))).add(new TagSpecDefinition(new coreSpec_1.FeatureVersion(0, 2))).add(new TagSpecDefinition(new coreSpec_1.FeatureVersion(0, 3), new coreSpec_1.FeatureVersion(2, 0)));\n(0, knownCoreFeatures_1.registerKnownFeature)(exports.TAG_VERSIONS);","map":{"version":3,"mappings":";;;;;;AAAA,MAAAA,SAAA,GAAAC,OAAA;AACA,MAAAC,UAAA,GAAAD,OAAA;AACA,MAAAE,aAAA,GAAAF,OAAA;AACA,MAAAG,+BAAA,GAAAH,OAAA;AACA,MAAAI,OAAA,GAAAJ,OAAA;AACA,MAAAK,mBAAA,GAAAL,OAAA;AACA,MAAAM,OAAA,GAAAN,OAAA;AAEaO,OAAA,CAAAC,WAAW,GAAG,8BAA8B;AAEzD,MAAaC,iBAAkB,SAAQR,UAAA,CAAAS,iBAAiB;EAKtDC,YAAYC,OAAuB,EAAEC,wBAAyC;IAC5E,KAAK,CAAC,IAAIZ,UAAA,CAAAa,UAAU,CAACP,OAAA,CAAAC,WAAW,EAAE,KAAK,EAAEI,OAAO,CAAC,EAAEC,wBAAwB,CAAC;IAC5E,IAAI,CAACE,YAAY,GAAG,CAClBhB,SAAA,CAAAiB,iBAAiB,CAACC,gBAAgB,EAClClB,SAAA,CAAAiB,iBAAiB,CAACE,MAAM,EACxBnB,SAAA,CAAAiB,iBAAiB,CAACG,SAAS,EAC3BpB,SAAA,CAAAiB,iBAAiB,CAACI,KAAK,CACxB;IACD,IAAI,CAACC,oBAAoB,GAAG,2FAA2F;IACvH,IAAI,CAAC,IAAI,CAACC,KAAK,EAAE,EAAE;MACjB,IAAI,CAACP,YAAY,CAACQ,IAAI,CACpBxB,SAAA,CAAAiB,iBAAiB,CAACQ,mBAAmB,EACrCzB,SAAA,CAAAiB,iBAAiB,CAACS,MAAM,EACxB1B,SAAA,CAAAiB,iBAAiB,CAACU,IAAI,EACtB3B,SAAA,CAAAiB,iBAAiB,CAACW,UAAU,EAC5B5B,SAAA,CAAAiB,iBAAiB,CAACY,YAAY,EAC9B7B,SAAA,CAAAiB,iBAAiB,CAACa,sBAAsB,CACzC;MACD,IAAI,CAACR,oBAAoB,GAAG,sLAAsL;MAClN,IAAI,CAAC,IAAI,CAACS,KAAK,EAAE,EAAE;QACjB,IAAI,CAACf,YAAY,CAACQ,IAAI,CAACxB,SAAA,CAAAiB,iBAAiB,CAACe,MAAM,CAAC;QAChD,IAAI,CAACV,oBAAoB,GAAG,+LAA+L;;;IAG/N,IAAI,CAACW,gBAAgB,GAAG,IAAA7B,+BAAA,CAAA8B,4BAA4B,EAAC;MACnDC,IAAI,EAAC,KAAK;MACVC,SAAS,EAAE,IAAI,CAACpB,YAAY;MAC5BqB,UAAU,EAAE,IAAI;MAChBC,IAAI,EAAE,CAAC;QAAEH,IAAI,EAAE,MAAM;QAAEI,IAAI,EAAGC,MAAM,IAAK,IAAIrC,aAAA,CAAAsC,WAAW,CAACD,MAAM,CAACE,UAAU,EAAE;MAAC,CAAE,CAAC;MAChFC,QAAQ,EAAE,IAAI;MACdC,uBAAuB,EAAGC,UAAU,IAAKrC,OAAA,CAAAsC,YAAY,CAACC,yBAAyB,CAACF,UAAU;KAC3F,CAAC;IACF,IAAI,CAACG,iBAAiB,CAAC,IAAI,CAACf,gBAAgB,CAAC;EAC/C;EAEQV,KAAKA,CAAA;IACX,OAAO,IAAI,CAACV,OAAO,CAACoC,MAAM,CAAC,IAAI/C,UAAA,CAAAgD,cAAc,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;EACtD;EAEQnB,KAAKA,CAAA;IACX,OAAO,IAAI,CAAClB,OAAO,CAACoC,MAAM,CAAC,IAAI/C,UAAA,CAAAgD,cAAc,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;EACtD;EAEAC,YAAYA,CAACX,MAAc;IACzB,OAAO,IAAI,CAACY,SAAS,CAACZ,MAAM,EAAE,KAAK,CAAE;EACvC;EAEAa,wBAAwBA,CAACC,UAA+B;IACtD,MAAMC,mBAAmB,GAAGC,MAAM,CAACC,IAAI,CAACH,UAAU,CAACI,SAAS,EAAE,CAAC,CAACC,MAAM,GAAG,CAAC;IAC1E,MAAMC,OAAO,GAAGN,UAAU,CAACO,QAAQ,CAAC,MAAM,CAAC;IAC3C,MAAMC,eAAe,GAAGF,OAAO,IAAI,IAAArD,OAAA,CAAAwD,QAAQ,EAACH,OAAO,CAACrB,IAAK,EAAE,IAAIpC,aAAA,CAAAsC,WAAW,CAACa,UAAU,CAACd,MAAM,EAAE,CAACE,UAAU,EAAE,CAAC,CAAC;IAC7G,MAAMsB,iBAAiB,GAAGV,UAAU,CAAClB,SAAS,CAAC6B,KAAK,CAACC,GAAG,IAAI,IAAI,CAAClD,YAAY,CAACmD,QAAQ,CAACD,GAAG,CAAC,CAAC;IAC5F,IAAIX,mBAAmB,IAAI,CAACO,eAAe,IAAI,CAACE,iBAAiB,EAAE;MACjE,OAAO3D,OAAA,CAAA+D,MAAM,CAACC,4BAA4B,CAACC,GAAG,CAC5C,0IAA0I,IAAI,CAAChD,oBAAoB,EAAE,CACtK;;IAEH,OAAOiD,SAAS;EAClB;;AA/DF/D,OAAA,CAAAE,iBAAA,GAAAA,iBAAA;AAkEaF,OAAA,CAAAsC,YAAY,GAAG,IAAI5C,UAAA,CAAAsE,kBAAkB,CAAoBhE,OAAA,CAAAC,WAAW,CAAC,CAC/EgE,GAAG,CAAC,IAAI/D,iBAAiB,CAAC,IAAIR,UAAA,CAAAgD,cAAc,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CACpDuB,GAAG,CAAC,IAAI/D,iBAAiB,CAAC,IAAIR,UAAA,CAAAgD,cAAc,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CACpDuB,GAAG,CAAC,IAAI/D,iBAAiB,CAAC,IAAIR,UAAA,CAAAgD,cAAc,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,IAAIhD,UAAA,CAAAgD,cAAc,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AAEjF,IAAA5C,mBAAA,CAAAoE,oBAAoB,EAAClE,OAAA,CAAAsC,YAAY,CAAC","names":["graphql_1","require","coreSpec_1","definitions_1","directiveAndTypeSpecification_1","error_1","knownCoreFeatures_1","types_1","exports","tagIdentity","TagSpecDefinition","FeatureDefinition","constructor","version","minimumFederationVersion","FeatureUrl","tagLocations","DirectiveLocation","FIELD_DEFINITION","OBJECT","INTERFACE","UNION","printedTagDefinition","isV01","push","ARGUMENT_DEFINITION","SCALAR","ENUM","ENUM_VALUE","INPUT_OBJECT","INPUT_FIELD_DEFINITION","isV02","SCHEMA","tagDirectiveSpec","createDirectiveSpecification","name","locations","repeatable","args","type","schema","NonNullType","stringType","composes","supergraphSpecification","fedVersion","TAG_VERSIONS","getMinimumRequiredVersion","registerDirective","equals","FeatureVersion","tagDirective","directive","checkCompatibleDirective","definition","hasUnknownArguments","Object","keys","arguments","length","nameArg","argument","hasValidNameArg","sameType","hasValidLocations","every","loc","includes","ERRORS","DIRECTIVE_DEFINITION_INVALID","err","undefined","FeatureDefinitions","add","registerKnownFeature"],"sourceRoot":"","sources":["../src/tagSpec.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}