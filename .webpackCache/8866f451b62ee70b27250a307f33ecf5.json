{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.whenResultIsFinished = exports.pluginsEnabledForSchemaResolvers = exports.enablePluginsForSchemaResolvers = exports.symbolUserFieldResolver = exports.symbolExecutionDispatcherWillResolveField = void 0;\nconst type_1 = require(\"graphql/type\");\nconst execution_1 = require(\"graphql/execution\");\nexports.symbolExecutionDispatcherWillResolveField = Symbol('apolloServerExecutionDispatcherWillResolveField');\nexports.symbolUserFieldResolver = Symbol('apolloServerUserFieldResolver');\nconst symbolPluginsEnabled = Symbol('apolloServerPluginsEnabled');\nfunction enablePluginsForSchemaResolvers(schema) {\n  if (pluginsEnabledForSchemaResolvers(schema)) {\n    return schema;\n  }\n  Object.defineProperty(schema, symbolPluginsEnabled, {\n    value: true\n  });\n  forEachField(schema, wrapField);\n  return schema;\n}\nexports.enablePluginsForSchemaResolvers = enablePluginsForSchemaResolvers;\nfunction pluginsEnabledForSchemaResolvers(schema) {\n  return !!schema[symbolPluginsEnabled];\n}\nexports.pluginsEnabledForSchemaResolvers = pluginsEnabledForSchemaResolvers;\nfunction wrapField(field) {\n  const originalFieldResolve = field.resolve;\n  field.resolve = (source, args, context, info) => {\n    const parentPath = info.path.prev;\n    const willResolveField = context === null || context === void 0 ? void 0 : context[exports.symbolExecutionDispatcherWillResolveField];\n    const userFieldResolver = context === null || context === void 0 ? void 0 : context[exports.symbolUserFieldResolver];\n    const didResolveField = typeof willResolveField === 'function' && willResolveField({\n      source,\n      args,\n      context,\n      info\n    });\n    const resolveObject = info.parentType.resolveObject;\n    let whenObjectResolved;\n    if (parentPath && resolveObject) {\n      if (!parentPath.__fields) {\n        parentPath.__fields = {};\n      }\n      parentPath.__fields[info.fieldName] = info.fieldNodes;\n      whenObjectResolved = parentPath.__whenObjectResolved;\n      if (!whenObjectResolved) {\n        whenObjectResolved = Promise.resolve().then(() => {\n          return resolveObject(source, parentPath.__fields, context, info);\n        });\n        parentPath.__whenObjectResolved = whenObjectResolved;\n      }\n    }\n    const fieldResolver = originalFieldResolve || userFieldResolver || execution_1.defaultFieldResolver;\n    try {\n      let result;\n      if (whenObjectResolved) {\n        result = whenObjectResolved.then(resolvedObject => {\n          return fieldResolver(resolvedObject, args, context, info);\n        });\n      } else {\n        result = fieldResolver(source, args, context, info);\n      }\n      if (typeof didResolveField === 'function') {\n        whenResultIsFinished(result, didResolveField);\n      }\n      return result;\n    } catch (error) {\n      if (typeof didResolveField === 'function') {\n        didResolveField(error);\n      }\n      throw error;\n    }\n  };\n}\nfunction isPromise(x) {\n  return x && typeof x.then === 'function';\n}\nfunction whenResultIsFinished(result, callback) {\n  if (isPromise(result)) {\n    result.then(r => callback(null, r), err => callback(err));\n  } else if (Array.isArray(result)) {\n    if (result.some(isPromise)) {\n      Promise.all(result).then(r => callback(null, r), err => callback(err));\n    } else {\n      callback(null, result);\n    }\n  } else {\n    callback(null, result);\n  }\n}\nexports.whenResultIsFinished = whenResultIsFinished;\nfunction forEachField(schema, fn) {\n  const typeMap = schema.getTypeMap();\n  Object.entries(typeMap).forEach(([typeName, type]) => {\n    if (!(0, type_1.getNamedType)(type).name.startsWith('__') && type instanceof type_1.GraphQLObjectType) {\n      const fields = type.getFields();\n      Object.entries(fields).forEach(([fieldName, field]) => {\n        fn(field, typeName, fieldName);\n      });\n    }\n  });\n}","map":{"version":3,"mappings":"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","names":["type_1","require","execution_1","exports","symbolExecutionDispatcherWillResolveField","Symbol","symbolUserFieldResolver","symbolPluginsEnabled","enablePluginsForSchemaResolvers","schema","pluginsEnabledForSchemaResolvers","Object","defineProperty","value","forEachField","wrapField","field","originalFieldResolve","resolve","source","args","context","info","parentPath","path","prev","willResolveField","userFieldResolver","didResolveField","resolveObject","parentType","whenObjectResolved","__fields","fieldName","fieldNodes","__whenObjectResolved","Promise","then","fieldResolver","defaultFieldResolver","result","resolvedObject","whenResultIsFinished","error","isPromise","x","callback","r","err","Array","isArray","some","all","fn","typeMap","getTypeMap","entries","forEach","typeName","type","getNamedType","name","startsWith","GraphQLObjectType","fields","getFields"],"sourceRoot":"","sources":["../../src/utils/schemaInstrumentation.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}