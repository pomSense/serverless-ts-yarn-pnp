{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.iterateOverTrace = void 0;\nfunction iterateOverTrace(trace, f, includePath) {\n  const rootPath = includePath ? new RootCollectingPathsResponseNamePath() : notCollectingPathsResponseNamePath;\n  if (trace.root) {\n    if (iterateOverTraceNode(trace.root, rootPath, f)) return;\n  }\n  if (trace.queryPlan) {\n    if (iterateOverQueryPlan(trace.queryPlan, rootPath, f)) return;\n  }\n}\nexports.iterateOverTrace = iterateOverTrace;\nfunction iterateOverQueryPlan(node, rootPath, f) {\n  var _a, _b, _c, _d, _e;\n  if (!node) return false;\n  if (((_b = (_a = node.fetch) === null || _a === void 0 ? void 0 : _a.trace) === null || _b === void 0 ? void 0 : _b.root) && node.fetch.serviceName) {\n    return iterateOverTraceNode(node.fetch.trace.root, rootPath.child(`service:${node.fetch.serviceName}`), f);\n  }\n  if ((_c = node.flatten) === null || _c === void 0 ? void 0 : _c.node) {\n    return iterateOverQueryPlan(node.flatten.node, rootPath, f);\n  }\n  if ((_d = node.parallel) === null || _d === void 0 ? void 0 : _d.nodes) {\n    return node.parallel.nodes.some(node => iterateOverQueryPlan(node, rootPath, f));\n  }\n  if ((_e = node.sequence) === null || _e === void 0 ? void 0 : _e.nodes) {\n    return node.sequence.nodes.some(node => iterateOverQueryPlan(node, rootPath, f));\n  }\n  return false;\n}\nfunction iterateOverTraceNode(node, path, f) {\n  var _a, _b;\n  if (f(node, path)) {\n    return true;\n  }\n  return (_b = (_a = node.child) === null || _a === void 0 ? void 0 : _a.some(child => {\n    const childPath = child.responseName ? path.child(child.responseName) : path;\n    return iterateOverTraceNode(child, childPath, f);\n  })) !== null && _b !== void 0 ? _b : false;\n}\nconst notCollectingPathsResponseNamePath = {\n  toArray() {\n    throw Error('not collecting paths!');\n  },\n  child() {\n    return this;\n  }\n};\nclass RootCollectingPathsResponseNamePath {\n  toArray() {\n    return [];\n  }\n  child(responseName) {\n    return new ChildCollectingPathsResponseNamePath(responseName, this);\n  }\n}\nclass ChildCollectingPathsResponseNamePath {\n  constructor(responseName, prev) {\n    this.responseName = responseName;\n    this.prev = prev;\n  }\n  toArray() {\n    const out = [];\n    let curr = this;\n    while (curr instanceof ChildCollectingPathsResponseNamePath) {\n      out.push(curr.responseName);\n      curr = curr.prev;\n    }\n    return out.reverse();\n  }\n  child(responseName) {\n    return new ChildCollectingPathsResponseNamePath(responseName, this);\n  }\n}","map":{"version":3,"mappings":"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","names":["iterateOverTrace","trace","f","includePath","rootPath","RootCollectingPathsResponseNamePath","notCollectingPathsResponseNamePath","root","iterateOverTraceNode","queryPlan","iterateOverQueryPlan","exports","node","_b","_a","fetch","serviceName","child","_c","flatten","_d","parallel","nodes","some","_e","sequence","path","childPath","responseName","toArray","Error","ChildCollectingPathsResponseNamePath","constructor","prev","out","curr","push","reverse"],"sourceRoot":"","sources":["../../../src/plugin/usageReporting/iterateOverTrace.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}