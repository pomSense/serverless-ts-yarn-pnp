{"ast":null,"code":"\"use strict\";\n\n// ATTRIBUTION: https://github.com/dougmoscrop/serverless-http\n\nconst http = require('http');\nconst headerEnd = '\\r\\n\\r\\n';\nconst BODY = Symbol('Response body');\nconst HEADERS = Symbol('Response headers');\nfunction getString(data) {\n  if (Buffer.isBuffer(data)) {\n    return data.toString('utf8');\n  } else if (typeof data === 'string') {\n    return data;\n  } else if (data instanceof Uint8Array) {\n    return new TextDecoder().decode(data);\n  } else {\n    throw new Error(`response.write() of unexpected type: ${typeof data}`);\n  }\n}\nfunction addData(stream, data) {\n  if (Buffer.isBuffer(data) || typeof data === 'string' || data instanceof Uint8Array) {\n    stream[BODY].push(Buffer.from(data));\n  } else {\n    throw new Error(`response.write() of unexpected type: ${typeof data}`);\n  }\n}\nmodule.exports = class ServerlessResponse extends http.ServerResponse {\n  static from(res) {\n    const response = new ServerlessResponse(res);\n    response.statusCode = res.statusCode;\n    response[HEADERS] = res.headers;\n    response[BODY] = [Buffer.from(res.body)];\n    response.end();\n    return response;\n  }\n  static body(res) {\n    return Buffer.concat(res[BODY]);\n  }\n  static headers(res) {\n    const headers = typeof res.getHeaders === 'function' ? res.getHeaders() : res._headers;\n    return Object.assign(headers, res[HEADERS]);\n  }\n  get headers() {\n    return this[HEADERS];\n  }\n  setHeader(key, value) {\n    if (this._wroteHeader) {\n      this[HEADERS][key] = value;\n    } else {\n      super.setHeader(key, value);\n    }\n  }\n  writeHead(statusCode, reason, obj) {\n    const headers = typeof reason === 'string' ? obj : reason;\n    for (const name in headers) {\n      this.setHeader(name, headers[name]);\n      if (!this._wroteHeader) {\n        // we only need to initiate super.headers once\n        // writeHead will add the other headers itself\n        break;\n      }\n    }\n    super.writeHead(statusCode, reason, obj);\n  }\n  constructor({\n    method\n  }) {\n    super({\n      method\n    });\n    this[BODY] = [];\n    this[HEADERS] = {};\n    this.useChunkedEncodingByDefault = false;\n    this.chunkedEncoding = false;\n    this._header = '';\n    this.assignSocket({\n      _writableState: {},\n      writable: true,\n      on: Function.prototype,\n      removeListener: Function.prototype,\n      destroy: Function.prototype,\n      cork: Function.prototype,\n      uncork: Function.prototype,\n      write: (data, encoding, cb) => {\n        if (typeof encoding === 'function') {\n          cb = encoding;\n          encoding = null;\n        }\n        if (this._header === '' || this._wroteHeader) {\n          addData(this, data);\n        } else {\n          const string = getString(data);\n          const index = string.indexOf(headerEnd);\n          if (index !== -1) {\n            const remainder = string.slice(index + headerEnd.length);\n            if (remainder) {\n              addData(this, remainder);\n            }\n            this._wroteHeader = true;\n          }\n        }\n        if (typeof cb === 'function') {\n          cb();\n        }\n      }\n    });\n  }\n};","map":{"version":3,"names":["http","require","headerEnd","BODY","Symbol","HEADERS","getString","data","Buffer","isBuffer","toString","Uint8Array","TextDecoder","decode","Error","addData","stream","push","from","module","exports","ServerlessResponse","ServerResponse","res","response","statusCode","headers","body","end","concat","getHeaders","_headers","Object","assign","setHeader","key","value","_wroteHeader","writeHead","reason","obj","name","constructor","method","useChunkedEncodingByDefault","chunkedEncoding","_header","assignSocket","_writableState","writable","on","Function","prototype","removeListener","destroy","cork","uncork","write","encoding","cb","string","index","indexOf","remainder","slice","length"],"sources":["/Users/pom/Code/serverless-ts-yarn-pnp/.yarn/cache/@vendia-serverless-express-npm-4.10.4-2e67e59920-f33d3f0f08.zip/node_modules/@vendia/serverless-express/src/response.js"],"sourcesContent":["// ATTRIBUTION: https://github.com/dougmoscrop/serverless-http\n\nconst http = require('http')\n\nconst headerEnd = '\\r\\n\\r\\n'\n\nconst BODY = Symbol('Response body')\nconst HEADERS = Symbol('Response headers')\n\nfunction getString (data) {\n  if (Buffer.isBuffer(data)) {\n    return data.toString('utf8')\n  } else if (typeof data === 'string') {\n    return data\n  } else if (data instanceof Uint8Array) {\n    return new TextDecoder().decode(data)\n  } else {\n    throw new Error(`response.write() of unexpected type: ${typeof data}`)\n  }\n}\n\nfunction addData (stream, data) {\n  if (Buffer.isBuffer(data) || typeof data === 'string' || data instanceof Uint8Array) {\n    stream[BODY].push(Buffer.from(data))\n  } else {\n    throw new Error(`response.write() of unexpected type: ${typeof data}`)\n  }\n}\n\nmodule.exports = class ServerlessResponse extends http.ServerResponse {\n  static from (res) {\n    const response = new ServerlessResponse(res)\n\n    response.statusCode = res.statusCode\n    response[HEADERS] = res.headers\n    response[BODY] = [Buffer.from(res.body)]\n    response.end()\n\n    return response\n  }\n\n  static body (res) {\n    return Buffer.concat(res[BODY])\n  }\n\n  static headers (res) {\n    const headers = typeof res.getHeaders === 'function'\n      ? res.getHeaders()\n      : res._headers\n\n    return Object.assign(headers, res[HEADERS])\n  }\n\n  get headers () {\n    return this[HEADERS]\n  }\n\n  setHeader (key, value) {\n    if (this._wroteHeader) {\n      this[HEADERS][key] = value\n    } else {\n      super.setHeader(key, value)\n    }\n  }\n\n  writeHead (statusCode, reason, obj) {\n    const headers = typeof reason === 'string'\n      ? obj\n      : reason\n\n    for (const name in headers) {\n      this.setHeader(name, headers[name])\n\n      if (!this._wroteHeader) {\n        // we only need to initiate super.headers once\n        // writeHead will add the other headers itself\n        break\n      }\n    }\n\n    super.writeHead(statusCode, reason, obj)\n  }\n\n  constructor ({ method }) {\n    super({ method })\n\n    this[BODY] = []\n    this[HEADERS] = {}\n\n    this.useChunkedEncodingByDefault = false\n    this.chunkedEncoding = false\n    this._header = ''\n\n    this.assignSocket({\n      _writableState: {},\n      writable: true,\n      on: Function.prototype,\n      removeListener: Function.prototype,\n      destroy: Function.prototype,\n      cork: Function.prototype,\n      uncork: Function.prototype,\n      write: (data, encoding, cb) => {\n        if (typeof encoding === 'function') {\n          cb = encoding\n          encoding = null\n        }\n\n        if (this._header === '' || this._wroteHeader) {\n          addData(this, data)\n        } else {\n          const string = getString(data)\n          const index = string.indexOf(headerEnd)\n\n          if (index !== -1) {\n            const remainder = string.slice(index + headerEnd.length)\n\n            if (remainder) {\n              addData(this, remainder)\n            }\n\n            this._wroteHeader = true\n          }\n        }\n\n        if (typeof cb === 'function') {\n          cb()\n        }\n      }\n    })\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}